# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с TS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемых в приложении: 
Интерфейс  `ILotItem` описывает товар подгруженный с сервера:
```
  id: string; уникальный id  товара;
  title: string; название товара;
  price: number | null; указывает цену товара или бесценность;
  category: string; категория товара;
  description: string; описание товара;
  image: string; url картинки товара;
```

Интерфейс  `ILots` описывает массив товаров интернет-магазина:
```  
  lots: ILotItem[]; 
```

Интерфейс `IOrderForm` описывает поля форм для заказа товаров:
```
  payment: string; метод оплаты;
  email: string; электронная почта;
  phone: string; контактный телефон;
  address: string; домашний адрес доставки;
  totalCost: number; общая цена корзины;
```

Данные пользователя при оформление заказа в модальном окне почты и контактного телефона:

```
type TUserInfoEmailPhone = Pick<IOrderForm, 'email' | 'phone'>;
```

Данные пользователя при оформление заказа в модальном окне выбора способа оплаты и адреса доставки:

```
type TUserInfoAddressPayment = Pick<IOrderForm, 'address' | 'payment'>;
```

Данные товаров при оформление списка покупок в корзине: 
```
type TBasket = Pick<ILotItem, 'id' | 'title' | 'price'>;
```

Интерфейс `IOrder` для описания результата заказа:
```
  id: string; идентификатор заказа;
  total: number; общая сумма;
```

## Архитектура приложения 

Код приложения разделён на слои согласно парадигме MVP:
- слой данных, отвечает за хранение и изменение данных,
- слой представения, отвечает за отображение данных на страниице, 
- слой презентера, отвечает за связь слоев данных и представления.

### Базовый код

#### Класс Api 
Имеет следующие методы:
- `get` - выполняет GET запрос на переданный в параметрах endpoint  и возращает promise  с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON  в теле запроса, и отправляет эти данные на endpoint переданный как парметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределён заданием третьего параметра при вызове.  

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. 

Методы, реализуемые классом  описаны интерфейсом `IEvents`:
- `on` - для подписки на событие.
- `emit` - уведомления подписчиков о наступлении события соответственно.
- `trigger` - генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter.

#### Класс Model
В параметры конструктора класса передается интерфейс `IEvents`. Базовая модель, чтобы можно было отличить ее от простых объектов с данными.

#### Класс Component
Базовый класс для использования в классах представления. Имеет необходимые методы для управления разметкой.

### Слой данных

#### Класс Lots
Класс  `Lots` отвечает за хранение и логику работы с данными товаров интернет-магазина.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _catalog: ILotItem[]; массив каталога товаров;
- _preview: string | null; id карточки, выбранной для просмотра в модальной окне;
- events: IEvents; экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getLotItem(lotId: string): ILotItem; возвращает карточку по ее id;
- getLots(lotId: string): ILotItem; возвращает массив товаров интернет-магазина;
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса;

#### Класс OrderLot
Класс `OrderLot` отвечает за хранение и логику работы с данными оформленных товаров интернет-магазина.\
Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:
- orderEmailPhone: TUserInfoEmailPhone; объект с данными контактной информации заказа
- orderAddressPayment: TUserInfoAddressPayment; объект с данными адреса заказа и способом оплаты;
- events: IEvents; экземпляр класса `EventEmitter` для инициализации событий при изменения данных;

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setAddressPayment(field: keyof TUserInfoAddressPayment, value: string): void; устанавливает данные адреса заказа и способа оплаты;
- setEmailPhone(field: keyof TUserInfoEmailPhone, value: string): void; устанавливает данные контактной информации заказа;
- checkValidateForm(): void; валидация форм;
- clearForm(): void; очистка форм;

#### Класс BasketLot
Класс `BasketLot` отвечает за работу с данными, связанными с корзиной, включая добавление и удаление товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- lotsBasket : TBasket[]; массив товаров интернет магазина.
- events: IEvents; экземпляр класса `EventEmitter` для инициализации событий при изменения данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addLotBasket(lot: ILotItem): void; добавляет один лот товара в корзину;
- deleteLotBasket(lotId: ILotItem): void; удаляет один лот товара из корзины;
- clearBasket(): void; очистить корзину;
- getLotsBasket(): string[]; получить массив товаров в корзине;
- getCountLotsBasket(): number; получить количество товаров в корзине;
- getTotalCost(): number; получить общую стоимость товаров в корзине;
- checkBasket(lotId: string): boolean; проверить наличие товара в корзине;

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(container: HTMLElement, protected events: IEvents) Конструктор принимает HTMLElement, по которому в разметке страницы будет идентифицирова нужный темплейт и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- protected _closeButton: HTMLButtonElement; кнопка закрытия модального окна;
- protected _content: HTMLElement; элемент модального окна;

Методы: 
- render(); отрисовка окна на странице;

#### Класс Form
Реализует класс для формы. Класс управляет состоянием формы и взаимодействием с ней. Предназначен для обработки валидации формы, отображения ошибок и событий отправки.
- constructor(container: HTMLFormElement, protected events: IEvents) Конструктор принимает HTMLFormElement, по которому в разметке страницы будет идентифицирова нужная форма и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
 - protected _submit: HTMLButtonElement;
 - protected _errors: HTMLElement;

Методы:
 - set valid(value: boolean); проверка валидность форм( включает \ отключает клавишу submit);
 - set errors(value: string); устанавливает ошибки для форм и обновляет элемент отображения ошибок;
 - render(); отображает состояние формы, включая валидность, ошибки и вводы;

#### Класс Page
Класс реализует собой главную страницу, на которой отображаются все товары интернет магазина, а также счетчик количества товаров, добавленных в корзину.
- constructor(container: HTMLElement, protected events: IEvents). Конструктор принимает контейнер, в котором размещаются карточки и экземпляр класса `EventEmitter` для возможности инициации событий. 

Поля класса:
 - protected _counter: HTMLElement;  элемент для отображения количества товаров в корзине;
 - protected _catalog: HTMLElement; элемент содержащий каталог всех товаров интернет магазина;
 - protected _wrapper: HTMLElement; элемент-обертка для всей страницы;
 - protected _basket: HTMLElement; элемент корзины;

Методы:
- set counter(value: number); устанавливает значение счетчика товаров в корзине;
- set catalog(items: HTMLElement[]); обновляет каталог товаров, заменяя его содержимое;
 - set locked(value: boolean); блокирует или разблокирует страницу;

#### Класс Basket 
Класс реализует собой корзину товаров. Отображает добавленные в корзину товары, общую сумму заказа и переход к оформлению заказа. 
- constructor(container: HTMLElement, protected events: IEvents). Конструктор принимает один из товаров интернет-магазина и экземпляр класса `EventEmitter` для возможности инициации событий. 

Поля класса:
 - protected _list: HTMLElement; список товаров в корзине;
 - protected _button: HTMLElement; кнопка для оформления заказа;
 - protected _total: HTMLElement; вся сумма заказа;

Методы:
- set items(items: HTMLElement[]); обновляет содержимое корзины;
- set selected(items: string[]); оценивает наличие товаров в корзине и делает активной или не активной клавишу оформления заказа;
 - set total(value: number); устанавливает общую сумму заказа и отображает её;

#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, отношение к группе товаров, цену. Класс используется для отображения карточки товара. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- render(): HTMLElement; метод возвращает полностью заполненную карточку с установленными слушателями;
- геттеры и сеттеры каждого поля товара;

#### Класс Success
Класс реализует собой вывод итоговой формы с поздравлением об успешной оплате выбранных товаров. Выводится информация о стоимости покупки, а так же предлагается закрывать форму и продолжить покупки.
- constructor(container: HTMLElement)Конструктор принимает форму успешного оформления товара.

Поля класса:
- protected _close: HTMLElement; закрытие модального окна;
- protected _total: HTMLElement; общая сумма заказа;

Метод:
 - set total(value: HTMLElement); отображающий общую сумму заказа;

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `lots:changed` - изменение массива карточек
- `lot:selected` - изменение открываемой в модальном окне картинки карточки

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket: open` - открытие корзины;
- `basket: delete` - удаление карточки из корзины;
- `basket: submit` - подтверждение данных корзины;
- `modal: open` - открытие модального окна;
- `modal: close` - закрытие модального окна;
- `addressPayment: open` - открытие формы с адресом заказа и способом оплаты;
- `emailPhone: open` - открытие формы с email  и номером телефона;
- `address: submit` - подтверждение формы с адресом заказа и способом оплаты;
- `contacts: submit` - подтверждение и отправка заказа на сервер
- `success: close` - закрытие модального окна успшеного оформления заказа.
